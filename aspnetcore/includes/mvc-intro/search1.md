# <a name="adding-search-to-an-aspnet-core-mvc-app"></a><span data-ttu-id="5ca36-101">Ajout d’une fonctionnalité de recherche à une application ASP.NET Core MVC</span><span class="sxs-lookup"><span data-stu-id="5ca36-101">Adding Search to an ASP.NET Core MVC app</span></span>

<span data-ttu-id="5ca36-102">Par [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="5ca36-102">By [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="5ca36-103">Dans cette section, vous ajoutez une fonctionnalité de recherche à la méthode d’action `Index` qui vous permet de rechercher des films par *genre* ou par *nom*.</span><span class="sxs-lookup"><span data-stu-id="5ca36-103">In this section you add search capability to the `Index` action method that lets you search movies by *genre* or *name*.</span></span>

<span data-ttu-id="5ca36-104">Mettez à jour la méthode `Index` avec le code suivant :</span><span class="sxs-lookup"><span data-stu-id="5ca36-104">Update the `Index` method with the following code:</span></span>
<!--
[!code-html[Main](../../tutorials/first-mvc-app/start-mvc/sample/MvcMovie/Views/Shared/_Layout.cshtml?highlight=7,31)]
-->

<span data-ttu-id="5ca36-105">[!code-csharp[Main](../../tutorials/first-mvc-app/start-mvc/sample/MvcMovie/Controllers/MoviesController.cs?name=snippet_1stSearch)]</span><span class="sxs-lookup"><span data-stu-id="5ca36-105">[!code-csharp[Main](../../tutorials/first-mvc-app/start-mvc/sample/MvcMovie/Controllers/MoviesController.cs?name=snippet_1stSearch)]</span></span>

<span data-ttu-id="5ca36-106">La première ligne de la méthode d’action `Index` crée une requête [LINQ](http://msdn.microsoft.com/library/bb397926.aspx) pour sélectionner les films :</span><span class="sxs-lookup"><span data-stu-id="5ca36-106">The first line of the `Index` action method creates a [LINQ](http://msdn.microsoft.com/library/bb397926.aspx) query to select the movies:</span></span>

```csharp
var movies = from m in _context.Movie
             select m;
```

<span data-ttu-id="5ca36-107">La requête est *seulement* définie à ce stade, elle n’a **pas** été exécutée sur la base de données.</span><span class="sxs-lookup"><span data-stu-id="5ca36-107">The query is *only* defined at this point, it has **not** been run against the database.</span></span>

<span data-ttu-id="5ca36-108">Si le paramètre `searchString` contient une chaîne, la requête de films est modifiée de façon à filtrer sur la valeur de la chaîne de recherche :</span><span class="sxs-lookup"><span data-stu-id="5ca36-108">If the `searchString` parameter contains a string, the movies query is modified to filter on the value of the search string:</span></span>

<span data-ttu-id="5ca36-109">[!code-csharp[Main](../../tutorials/first-mvc-app/start-mvc/sample/MvcMovie/Controllers/MoviesController.cs?name=snippet_SearchNull)]</span><span class="sxs-lookup"><span data-stu-id="5ca36-109">[!code-csharp[Main](../../tutorials/first-mvc-app/start-mvc/sample/MvcMovie/Controllers/MoviesController.cs?name=snippet_SearchNull)]</span></span>

<span data-ttu-id="5ca36-110">Le code `s => s.Title.Contains()` ci-dessus est une [expression lambda](http://msdn.microsoft.com/library/bb397687.aspx).</span><span class="sxs-lookup"><span data-stu-id="5ca36-110">The `s => s.Title.Contains()` code above is a [Lambda Expression](http://msdn.microsoft.com/library/bb397687.aspx).</span></span> <span data-ttu-id="5ca36-111">Les expressions lambda sont utilisées dans les requêtes [LINQ](http://msdn.microsoft.com/library/bb397926.aspx) basées sur une méthode en tant qu’arguments pour les méthodes d’opérateur de requête standard, comme la méthode [Where](http://msdn.microsoft.com/library/system.linq.enumerable.where.aspx) ou `Contains` (utilisée dans le code ci-dessus).</span><span class="sxs-lookup"><span data-stu-id="5ca36-111">Lambdas are used in method-based [LINQ](http://msdn.microsoft.com/library/bb397926.aspx) queries as arguments to standard query operator methods such as the [Where](http://msdn.microsoft.com/library/system.linq.enumerable.where.aspx) method or `Contains` (used in the code above).</span></span> <span data-ttu-id="5ca36-112">Les requêtes LINQ ne sont pas exécutées quand elles sont définies ou quand elles sont modifiées en appelant une méthode comme `Where`, `Contains` ou `OrderBy`.</span><span class="sxs-lookup"><span data-stu-id="5ca36-112">LINQ queries are not executed when they are defined or when they are modified by calling a method such as `Where`, `Contains`  or `OrderBy`.</span></span> <span data-ttu-id="5ca36-113">Au lieu de cela, l’exécution de la requête est différée.</span><span class="sxs-lookup"><span data-stu-id="5ca36-113">Rather, query execution is deferred.</span></span>  <span data-ttu-id="5ca36-114">Cela signifie que l’évaluation d’une expression est retardée jusqu’à ce que sa valeur réalisée fasse l’objet d’une itération réelle ou que la méthode `ToListAsync` soit appelée.</span><span class="sxs-lookup"><span data-stu-id="5ca36-114">That means that the evaluation of an expression is delayed until its realized value is actually iterated over or the `ToListAsync` method is called.</span></span> <span data-ttu-id="5ca36-115">Pour plus d’informations sur l’exécution différée des requêtes, consultez [Exécution de requête](http://msdn.microsoft.com/library/bb738633.aspx).</span><span class="sxs-lookup"><span data-stu-id="5ca36-115">For more information about deferred query execution, see [Query Execution](http://msdn.microsoft.com/library/bb738633.aspx).</span></span>

<span data-ttu-id="5ca36-116">Remarque : La méthode [Contains](http://msdn.microsoft.com/library/bb155125.aspx) est exécutée sur la base de données, et non pas dans le code C# ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="5ca36-116">Note: The [Contains](http://msdn.microsoft.com/library/bb155125.aspx) method is run on the database, not in the c# code shown above.</span></span> <span data-ttu-id="5ca36-117">Le respect de la casse pour la requête dépend de la base de données et du classement.</span><span class="sxs-lookup"><span data-stu-id="5ca36-117">The case sensitivity on the query depends on the database and the collation.</span></span> <span data-ttu-id="5ca36-118">Sur SQL Server, [Contains](http://msdn.microsoft.com/library/bb155125.aspx) est mappé à [SQL LIKE](http://msdn.microsoft.com/library/ms179859.aspx), qui ne respecte pas la casse.</span><span class="sxs-lookup"><span data-stu-id="5ca36-118">On SQL Server, [Contains](http://msdn.microsoft.com/library/bb155125.aspx) maps to [SQL LIKE](http://msdn.microsoft.com/library/ms179859.aspx), which is case insensitive.</span></span> <span data-ttu-id="5ca36-119">Dans SQLite, avec le classement par défaut, elle respecte la casse.</span><span class="sxs-lookup"><span data-stu-id="5ca36-119">In SQLlite, with the default collation, it's case sensitive.</span></span>

<span data-ttu-id="5ca36-120">Accédez à `/Movies/Index`.</span><span class="sxs-lookup"><span data-stu-id="5ca36-120">Navigate to `/Movies/Index`.</span></span> <span data-ttu-id="5ca36-121">Ajoutez une chaîne de requête comme `?searchString=Ghost` à l’URL.</span><span class="sxs-lookup"><span data-stu-id="5ca36-121">Append a query string such as `?searchString=Ghost` to the URL.</span></span> <span data-ttu-id="5ca36-122">Les films filtrés sont affichés.</span><span class="sxs-lookup"><span data-stu-id="5ca36-122">The filtered movies are displayed.</span></span>

![Vue Index](../../tutorials/first-mvc-app/search/_static/ghost.png)

<span data-ttu-id="5ca36-124">Si vous changez la signature de la méthode `Index` pour y inclure un paramètre nommé `id`, le paramètre`id` correspondra à l’espace réservé facultatif `{id}` pour les routes par défaut définies dans *Startup.cs*.</span><span class="sxs-lookup"><span data-stu-id="5ca36-124">If you change the signature of the `Index` method to have a parameter named `id`, the `id` parameter will match the optional `{id}` placeholder for the default routes set in *Startup.cs*.</span></span>

<span data-ttu-id="5ca36-125">[!code-csharp[Main](../../tutorials/first-mvc-app/start-mvc/sample/MvcMovie/Startup.cs?highlight=5&name=snippet_1)]</span><span class="sxs-lookup"><span data-stu-id="5ca36-125">[!code-csharp[Main](../../tutorials/first-mvc-app/start-mvc/sample/MvcMovie/Startup.cs?highlight=5&name=snippet_1)]</span></span>