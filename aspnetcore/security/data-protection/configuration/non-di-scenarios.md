---
title: "Scénarios non DI"
author: rick-anderson
description: 
keywords: ASP.NET Core,
ms.author: riande
manager: wpickett
ms.date: 10/14/2016
ms.topic: article
ms.assetid: a7d8a962-80ff-48e3-96f6-8472b7ba2df9
ms.technology: aspnet
ms.prod: asp.net-core
uid: security/data-protection/configuration/non-di-scenarios
ms.openlocfilehash: 54a930c26f9f48ea0e6f7865e2927bcde0f4d6c0
ms.sourcegitcommit: 0b6c8e6d81d2b3c161cd375036eecbace46a9707
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/11/2017
---
# <a name="non-di-aware-scenarios"></a><span data-ttu-id="d4298-103">Scénarios non DI</span><span class="sxs-lookup"><span data-stu-id="d4298-103">Non DI aware scenarios</span></span>

<span data-ttu-id="d4298-104">Le système de protection des données est généralement conçu [à ajouter à un conteneur de service](../consumer-apis/overview.md) et doivent être fournies pour les composants dépendants via un mécanisme DI.</span><span class="sxs-lookup"><span data-stu-id="d4298-104">The data protection system is normally designed [to be added to a service container](../consumer-apis/overview.md) and to be provided to dependent components via a DI mechanism.</span></span> <span data-ttu-id="d4298-105">Toutefois, il peut être certains cas où cela n’est pas possible, en particulier lors de l’importation du système dans une application existante.</span><span class="sxs-lookup"><span data-stu-id="d4298-105">However, there may be some cases where this is not feasible, especially when importing the system into an existing application.</span></span>

<span data-ttu-id="d4298-106">Pour prendre en charge ces scénarios le package Microsoft.AspNetCore.DataProtection.Extensions fournit un type concret DataProtectionProvider qui offre un moyen simple d’utiliser le système de protection des données sans passer par les chemins de code DI spécifiques.</span><span class="sxs-lookup"><span data-stu-id="d4298-106">To support these scenarios the package Microsoft.AspNetCore.DataProtection.Extensions provides a concrete type DataProtectionProvider which offers a simple way to use the data protection system without going through DI-specific code paths.</span></span> <span data-ttu-id="d4298-107">Le type lui-même implémente IDataProtectionProvider, et la construction d’elle est aussi simple que de fournir un DirectoryInfo où les clés de chiffrement de ce fournisseur doivent être stockées.</span><span class="sxs-lookup"><span data-stu-id="d4298-107">The type itself implements IDataProtectionProvider, and constructing it is as easy as providing a DirectoryInfo where this provider's cryptographic keys should be stored.</span></span>

<span data-ttu-id="d4298-108">Exemple :</span><span class="sxs-lookup"><span data-stu-id="d4298-108">For example:</span></span>

<span data-ttu-id="d4298-109">[!code-none[Main](non-di-scenarios/_static/nodisample1.cs)]</span><span class="sxs-lookup"><span data-stu-id="d4298-109">[!code-none[Main](non-di-scenarios/_static/nodisample1.cs)]</span></span>

>[!WARNING]
> <span data-ttu-id="d4298-110">Par défaut le DataProtectionProvider type concret ne chiffre pas les matières premières de clés avant de le rendre au système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="d4298-110">By default the DataProtectionProvider concrete type does not encrypt raw key material before persisting it to the file system.</span></span> <span data-ttu-id="d4298-111">Il s’agit pour prendre en charge les scénarios où les points de développeur à un réseau partagent, auquel cas le système de protection des données ne peut pas déduire automatiquement un mécanisme de chiffrement de clé approprié au repos.</span><span class="sxs-lookup"><span data-stu-id="d4298-111">This is to support scenarios where the developer points to a network share, in which case the data protection system cannot automatically deduce an appropriate at-rest key encryption mechanism.</span></span>
>
><span data-ttu-id="d4298-112">En outre, le type concret DataProtectionProvider n’est pas [isoler les applications](overview.md#data-protection-configuration-per-app-isolation) par défaut, par conséquent, toutes les applications de pointer vers le même répertoire clé peuvent partager les charges utiles tant que leurs objectif les paramètres correspondent aux.</span><span class="sxs-lookup"><span data-stu-id="d4298-112">Additionally, the DataProtectionProvider concrete type does not [isolate applications](overview.md#data-protection-configuration-per-app-isolation) by default, so all applications pointed at the same key directory can share payloads as long as their purpose parameters match.</span></span>

<span data-ttu-id="d4298-113">Le développeur d’applications peut traiter ces deux si vous le souhaitez.</span><span class="sxs-lookup"><span data-stu-id="d4298-113">The application developer can address both of these if desired.</span></span> <span data-ttu-id="d4298-114">Le constructeur DataProtectionProvider accepte un [rappel de configuration facultatives](overview.md#data-protection-configuration-callback) qui peut être utilisé pour modifier les comportements du système.</span><span class="sxs-lookup"><span data-stu-id="d4298-114">The DataProtectionProvider constructor accepts an [optional configuration callback](overview.md#data-protection-configuration-callback) which can be used to tweak the behaviors of the system.</span></span> <span data-ttu-id="d4298-115">L’exemple ci-dessous illustre la restauration d’isolement via un appel explicite à SetApplicationName, et il montre également la configuration du système pour chiffrer automatiquement des clés persistantes à l’aide de DPAPI Windows.</span><span class="sxs-lookup"><span data-stu-id="d4298-115">The sample below demonstrates restoring isolation via an explicit call to SetApplicationName, and it also demonstrates configuring the system to automatically encrypt persisted keys using Windows DPAPI.</span></span> <span data-ttu-id="d4298-116">Si le répertoire pointe vers un partage UNC, vous pouvez d’à distribuer un certificat partagé sur tous les ordinateurs appropriés et pour configurer le système pour utiliser le chiffrement de certificat à la place via un appel à [ProtectKeysWithCertificate](overview.md#configuring-x509-certificate).</span><span class="sxs-lookup"><span data-stu-id="d4298-116">If the directory points to a UNC share, you may wish to distribute a shared certificate across all relevant machines and to configure the system to use certificate-based encryption instead via a call to [ProtectKeysWithCertificate](overview.md#configuring-x509-certificate).</span></span>

<span data-ttu-id="d4298-117">[!code-none[Main](non-di-scenarios/_static/nodisample2.cs)]</span><span class="sxs-lookup"><span data-stu-id="d4298-117">[!code-none[Main](non-di-scenarios/_static/nodisample2.cs)]</span></span>

>[!TIP]
> <span data-ttu-id="d4298-118">Les instances du type concret DataProtectionProvider sont coûteuses à créer.</span><span class="sxs-lookup"><span data-stu-id="d4298-118">Instances of the DataProtectionProvider concrete type are expensive to create.</span></span> <span data-ttu-id="d4298-119">Si une application gère plusieurs instances de ce type, et si elles êtes pointe sur le même répertoire de stockage de clés, les performances de l’application peuvent se dégrader.</span><span class="sxs-lookup"><span data-stu-id="d4298-119">If an application maintains multiple instances of this type and if they're all pointing at the same key storage directory, application performance may be degraded.</span></span> <span data-ttu-id="d4298-120">L’utilisation prévue est que le développeur d’applications d’instancier une fois ce type de conserver la réutilisation de cette référence unique autant que possible.</span><span class="sxs-lookup"><span data-stu-id="d4298-120">The intended usage is that the application developer instantiate this type once then keep reusing this single reference as much as possible.</span></span> <span data-ttu-id="d4298-121">Le type DataProtectionProvider et toutes les instances de IDataProtector créés à partir de celui-ci sont thread-safe pour les appelants plusieurs.</span><span class="sxs-lookup"><span data-stu-id="d4298-121">The DataProtectionProvider type and all IDataProtector instances created from it are thread-safe for multiple callers.</span></span>
