---
title: "Durée de vie et de gestion de clés"
author: rick-anderson
description: "Décrit la durée de vie et de gestion de clés."
keywords: "ASP.NET Core, la gestion, DPAPI, DataProtection clé"
ms.author: riande
manager: wpickett
ms.date: 10/14/2016
ms.topic: article
ms.assetid: ef7dad2a-7029-4ae5-8f06-1fbebedccaa4
ms.technology: aspnet
ms.prod: asp.net-core
uid: security/data-protection/configuration/default-settings
ms.openlocfilehash: 913eda69f88ef05a990d9465024f4fa6b08cd1b7
ms.sourcegitcommit: 0b6c8e6d81d2b3c161cd375036eecbace46a9707
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/11/2017
---
# <a name="key-management-and-lifetime"></a><span data-ttu-id="a29e0-104">Durée de vie et de gestion de clés</span><span class="sxs-lookup"><span data-stu-id="a29e0-104">Key management and lifetime</span></span>

<a name=data-protection-default-settings></a>

## <a name="key-management"></a><span data-ttu-id="a29e0-105">Gestion de clés</span><span class="sxs-lookup"><span data-stu-id="a29e0-105">Key Management</span></span>

<span data-ttu-id="a29e0-106">Le système tente de détecter de son environnement d’exploitation et fournissent une bonne sans aucune configuration comportementales valeurs par défaut.</span><span class="sxs-lookup"><span data-stu-id="a29e0-106">The system tries to detect its operational environment and provide good zero-configuration behavioral defaults.</span></span> <span data-ttu-id="a29e0-107">L’heuristique utilisée est la suivante.</span><span class="sxs-lookup"><span data-stu-id="a29e0-107">The heuristic used is as follows.</span></span>

1. <span data-ttu-id="a29e0-108">Si le système est hébergé dans les Sites Web Azure, les clés sont conservés dans le dossier « % HOME%\ASP.NET\DataProtection-Keys ».</span><span class="sxs-lookup"><span data-stu-id="a29e0-108">If the system is being hosted in Azure Web Sites, keys are persisted to the "%HOME%\ASP.NET\DataProtection-Keys" folder.</span></span> <span data-ttu-id="a29e0-109">Ce dossier est sauvegardé par le stockage réseau et est synchronisé sur tous les ordinateurs hébergeant l’application.</span><span class="sxs-lookup"><span data-stu-id="a29e0-109">This folder is backed by network storage and is synchronized across all machines hosting the application.</span></span> <span data-ttu-id="a29e0-110">Les clés ne sont pas protégées au repos.</span><span class="sxs-lookup"><span data-stu-id="a29e0-110">Keys are not protected at rest.</span></span> <span data-ttu-id="a29e0-111">Ce dossier fournit l’anneau de clé à toutes les instances d’une application dans un emplacement de déploiement.</span><span class="sxs-lookup"><span data-stu-id="a29e0-111">This folder supplies the key ring to all instances of an application in a single deployment slot.</span></span> <span data-ttu-id="a29e0-112">Les emplacements de déploiement distinct, telles que les intermédiaires et de Production, pas partagent un anneau de clé.</span><span class="sxs-lookup"><span data-stu-id="a29e0-112">Separate deployment slots, such as Staging and Production, will not share a key ring.</span></span> <span data-ttu-id="a29e0-113">Lorsque vous échangez entre les emplacements de déploiement, par exemple le remplacement intermédiaire en Production ou à l’aide de / B test, n’importe quel système à l’aide de la protection des données ne sera pas en mesure de déchiffrer les données stockées à l’aide de l’anneau de clé à l’intérieur de l’emplacement précédent.</span><span class="sxs-lookup"><span data-stu-id="a29e0-113">When you swap between deployment slots, for example swapping Staging to Production or using A/B testing, any system using data protection will not be able to decrypt stored data using the key ring inside the previous slot.</span></span> <span data-ttu-id="a29e0-114">Cela entraîne des utilisateurs est enregistrés en dehors d’une application ASP.NET qui utilise le middleware du cookie ASP.NET standard, car elle utilise la protection des données à protéger ses cookies.</span><span class="sxs-lookup"><span data-stu-id="a29e0-114">This will lead to users being logged out of an ASP.NET application that uses the standard ASP.NET cookie middleware, as it uses data protection to protect its cookies.</span></span> <span data-ttu-id="a29e0-115">Si vous le souhaitez, indépendant de l’emplacement de clé anneaux utilisent un fournisseur de l’anneau de clé externe, telles que le stockage Blob Azure, Azure Key Vault, un magasin SQL, ou le cache Redis.</span><span class="sxs-lookup"><span data-stu-id="a29e0-115">If you desire slot-independent key rings, use an external key ring provider, such as Azure Blob Storage, Azure Key Vault, a SQL store, or Redis cache.</span></span>

2. <span data-ttu-id="a29e0-116">Si le profil utilisateur est disponible, les clés sont conservés dans le dossier « % LOCALAPPDATA%\ASP.NET\DataProtection-Keys ».</span><span class="sxs-lookup"><span data-stu-id="a29e0-116">If the user profile is available, keys are persisted to the "%LOCALAPPDATA%\ASP.NET\DataProtection-Keys" folder.</span></span> <span data-ttu-id="a29e0-117">En outre, si le système d’exploitation est Windows, ils allez chiffrées au repos à l’aide de DPAPI.</span><span class="sxs-lookup"><span data-stu-id="a29e0-117">Additionally, if the operating system is Windows, they'll be encrypted at rest using DPAPI.</span></span>

3. <span data-ttu-id="a29e0-118">Si l’application est hébergée dans IIS, les clés sont conservées dans le Registre HKLM dans une clé de Registre spéciale qui est l’ACL sur uniquement pour le compte de processus de travail.</span><span class="sxs-lookup"><span data-stu-id="a29e0-118">If the application is hosted in IIS, keys are persisted to the HKLM registry in a special registry key that is ACLed only to the worker process account.</span></span> <span data-ttu-id="a29e0-119">Les clés sont chiffrées au repos à l’aide de DPAPI.</span><span class="sxs-lookup"><span data-stu-id="a29e0-119">Keys are encrypted at rest using DPAPI.</span></span>

4. <span data-ttu-id="a29e0-120">Si aucune de ces conditions correspond à, les clés ne sont pas conservés en dehors du processus en cours.</span><span class="sxs-lookup"><span data-stu-id="a29e0-120">If none of these conditions matches, keys are not persisted outside of the current process.</span></span> <span data-ttu-id="a29e0-121">Lorsque le processus s’arrête, tous les généré clés seront perdues.</span><span class="sxs-lookup"><span data-stu-id="a29e0-121">When the process shuts down, all generated keys will be lost.</span></span>

<span data-ttu-id="a29e0-122">Le développeur est toujours dans un contrôle total et peut remplacer comment et où les clés sont stockées.</span><span class="sxs-lookup"><span data-stu-id="a29e0-122">The developer is always in full control and can override how and where keys are stored.</span></span> <span data-ttu-id="a29e0-123">Les trois premières options ci-dessus doivent bonnes valeurs par défaut pour la plupart des applications similaires à la manière dont ASP.NET <machineKey> les routines de la génération automatique a fonctionné dans le passé.</span><span class="sxs-lookup"><span data-stu-id="a29e0-123">The first three options above should good defaults for most applications similar to how the ASP.NET <machineKey> auto-generation routines worked in the past.</span></span> <span data-ttu-id="a29e0-124">Finale, l’option de restauration sont classés est le seul scénario qui nécessite réellement au développeur de spécifier [configuration](overview.md) initial s’ils veulent persistance des clés, mais ce recours se produit uniquement dans les rares cas.</span><span class="sxs-lookup"><span data-stu-id="a29e0-124">The final, fall back option is the only scenario that truly requires the developer to specify [configuration](overview.md) upfront if they want key persistence, but this fall-back would only occur in rare situations.</span></span>

>[!WARNING]
> <span data-ttu-id="a29e0-125">Si le développeur remplace cette heuristique et pointe le système de protection des données dans un dépôt de clé spécifique, le chiffrement automatique de clés au repos sera désactivé.</span><span class="sxs-lookup"><span data-stu-id="a29e0-125">If the developer overrides this heuristic and points the data protection system at a specific key repository, automatic encryption of keys at rest will be disabled.</span></span> <span data-ttu-id="a29e0-126">Au repos la protection peut être réactivée via [configuration](overview.md).</span><span class="sxs-lookup"><span data-stu-id="a29e0-126">At rest protection can be re-enabled via [configuration](overview.md).</span></span>

## <a name="key-lifetime"></a><span data-ttu-id="a29e0-127">Durée de vie</span><span class="sxs-lookup"><span data-stu-id="a29e0-127">Key Lifetime</span></span>

<span data-ttu-id="a29e0-128">Par défaut, les clés ont une durée de vie de 90 jours.</span><span class="sxs-lookup"><span data-stu-id="a29e0-128">Keys by default have a 90-day lifetime.</span></span> <span data-ttu-id="a29e0-129">Lorsqu’une clé expire, le système sera automatiquement générer une nouvelle clé et définir la nouvelle clé comme clé active.</span><span class="sxs-lookup"><span data-stu-id="a29e0-129">When a key expires, the system will automatically generate a new key and set the new key as the active key.</span></span> <span data-ttu-id="a29e0-130">Tant que clés supprimées restent sur le système, que vous serez toujours en mesure de déchiffrer les données protégées avec eux.</span><span class="sxs-lookup"><span data-stu-id="a29e0-130">As long as retired keys remain on the system you will still be able to decrypt any data protected with them.</span></span> <span data-ttu-id="a29e0-131">Consultez [gestion de clés](../implementation/key-management.md#data-protection-implementation-key-management-expiration) pour plus d’informations.</span><span class="sxs-lookup"><span data-stu-id="a29e0-131">See [key management](../implementation/key-management.md#data-protection-implementation-key-management-expiration) for more information.</span></span>

## <a name="default-algorithms"></a><span data-ttu-id="a29e0-132">Algorithmes par défaut</span><span class="sxs-lookup"><span data-stu-id="a29e0-132">Default Algorithms</span></span>

<span data-ttu-id="a29e0-133">L’algorithme de protection de charge utile par défaut utilisé est AES-256-CBC pour la confidentialité et HMACSHA256 authenticité.</span><span class="sxs-lookup"><span data-stu-id="a29e0-133">The default payload protection algorithm used is AES-256-CBC for confidentiality and HMACSHA256 for authenticity.</span></span> <span data-ttu-id="a29e0-134">Une clé principale de 512 bits, tous les 90 jours, de restauration est utilisée pour dériver les deux sous-clés utilisés pour ces algorithmes sur une base par charge.</span><span class="sxs-lookup"><span data-stu-id="a29e0-134">A 512-bit master key, rolled every 90 days, is used to derive the two sub-keys used for these algorithms on a per-payload basis.</span></span> <span data-ttu-id="a29e0-135">Consultez [des sous-clés de dérivation](../implementation/subkeyderivation.md#data-protection-implementation-subkey-derivation-aad) pour plus d’informations.</span><span class="sxs-lookup"><span data-stu-id="a29e0-135">See [subkey derivation](../implementation/subkeyderivation.md#data-protection-implementation-subkey-derivation-aad) for more information.</span></span>
